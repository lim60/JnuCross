package com.finsupplychain.car.contractwrapper.xuperchain;

import com.fasterxml.jackson.core.JsonProcessingException;
import com.jnu.jnucross.chains.FunctionResult;
import com.jnu.jnucross.chains.xuperchain.XuperChainWrapper;
import org.junit.Test;

import java.math.BigInteger;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

/**
 * @author jessy-js
 * @ClassName EvidenceXCWrapper
 * @Date 2023/8/28 18:44
 * @Version V1.0
 * @Description
 */
public class EvidenceXCWrapper {
    public static String abi = "[{\"inputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"evidenceIndex\",\"type\":\"uint256\"},{\"internalType\":\"string\",\"name\":\"publicKey\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"indiviSignature\",\"type\":\"string\"}],\"name\":\"addSignatures\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"orderIndex\",\"type\":\"uint256\"},{\"internalType\":\"string\",\"name\":\"evidenceDigest\",\"type\":\"string\"}],\"name\":\"newEvidence\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"},{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"evidenceIndex\",\"type\":\"uint256\"}],\"name\":\"queryEvidenceState\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"evidenceIndex\",\"type\":\"uint256\"},{\"internalType\":\"string\",\"name\":\"newState\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"evidenceDigest\",\"type\":\"string\"}],\"name\":\"updateEvidence\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"},{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"stateMutability\":\"nonpayable\",\"type\":\"function\"}]";
    public static String bin = "608060405234801561001057600080fd5b506116ea806100206000396000f3fe608060405234801561001057600080fd5b506004361061004c5760003560e01c806318b0986b146100515780638169c61114610081578063fad36822146100b3578063fcdaad0f146100e5575b600080fd5b61006b60048036038101906100669190610c4f565b610116565b6040516100789190610d0c565b60405180910390f35b61009b60048036038101906100969190610e63565b61059d565b6040516100aa93929190610efd565b60405180910390f35b6100cd60048036038101906100c89190610f42565b610a4f565b6040516100dc93929190610efd565b60405180910390f35b6100ff60048036038101906100fa9190610e63565b610b43565b60405161010d929190610f9e565b60405180910390f35b606080600080600085815260200190815260200160002090506001600981111561014357610142610fd5565b5b8160010160009054906101000a900460ff16600981111561016757610166610fd5565b5b036101a9576040518060400160405280601281526020017f437573746f6d43657274696669636174656400000000000000000000000000008152509150610593565b600260098111156101bd576101bc610fd5565b5b8160010160009054906101000a900460ff1660098111156101e1576101e0610fd5565b5b03610223576040518060400160405280600c81526020017f546178436f6c6c656374656400000000000000000000000000000000000000008152509150610592565b6003600981111561023757610236610fd5565b5b8160010160009054906101000a900460ff16600981111561025b5761025a610fd5565b5b0361029d576040518060400160405280600881526020017f496d706f727465640000000000000000000000000000000000000000000000008152509150610591565b600460098111156102b1576102b0610fd5565b5b8160010160009054906101000a900460ff1660098111156102d5576102d4610fd5565b5b03610317576040518060400160405280600681526020017f6f6e506f727400000000000000000000000000000000000000000000000000008152509150610590565b6005600981111561032b5761032a610fd5565b5b8160010160009054906101000a900460ff16600981111561034f5761034e610fd5565b5b03610391576040518060400160405280600a81526020017f57617265686f7573656400000000000000000000000000000000000000000000815250915061058f565b600660098111156103a5576103a4610fd5565b5b8160010160009054906101000a900460ff1660098111156103c9576103c8610fd5565b5b0361040b576040518060400160405280600681526020017f4c6f616465640000000000000000000000000000000000000000000000000000815250915061058e565b6007600981111561041f5761041e610fd5565b5b8160010160009054906101000a900460ff16600981111561044357610442610fd5565b5b03610485576040518060400160405280600681526020017f5369676e65640000000000000000000000000000000000000000000000000000815250915061058d565b6008600981111561049957610498610fd5565b5b8160010160009054906101000a900460ff1660098111156104bd576104bc610fd5565b5b036104ff576040518060400160405280600881526020017f526566756e646564000000000000000000000000000000000000000000000000815250915061058c565b60098081111561051257610511610fd5565b5b8160010160009054906101000a900460ff16600981111561053657610535610fd5565b5b03610578576040518060400160405280600a81526020017f44656c6976657269656400000000000000000000000000000000000000000000815250915061058b565b6040518060200160405280600081525091505b5b5b5b5b5b5b5b5b8192505050919050565b60006060806000806000888152602001908152602001600020905080600301859080600181540180825580915050600190039060005260206000200160009091909190915090816105ee9190611210565b506040516020016105fe90611339565b6040516020818303038152906040528051906020012086604051602001610625919061137f565b60405160208183030381529060405280519060200120036106725760018160010160006101000a81548160ff0219169083600981111561066857610667610fd5565b5b0217905550610a3c565b604051602001610681906113e2565b60405160208183030381529060405280519060200120866040516020016106a8919061137f565b60405160208183030381529060405280519060200120036106f55760028160010160006101000a81548160ff021916908360098111156106eb576106ea610fd5565b5b0217905550610a3b565b60405160200161070490611443565b604051602081830303815290604052805190602001208660405160200161072b919061137f565b60405160208183030381529060405280519060200120036107785760038160010160006101000a81548160ff0219169083600981111561076e5761076d610fd5565b5b0217905550610a3a565b604051602001610787906114a4565b60405160208183030381529060405280519060200120866040516020016107ae919061137f565b60405160208183030381529060405280519060200120036107fb5760048160010160006101000a81548160ff021916908360098111156107f1576107f0610fd5565b5b0217905550610a39565b60405160200161080a90611505565b6040516020818303038152906040528051906020012086604051602001610831919061137f565b604051602081830303815290604052805190602001200361087e5760058160010160006101000a81548160ff0219169083600981111561087457610873610fd5565b5b0217905550610a38565b60405160200161088d90611566565b60405160208183030381529060405280519060200120866040516020016108b4919061137f565b60405160208183030381529060405280519060200120036109015760068160010160006101000a81548160ff021916908360098111156108f7576108f6610fd5565b5b0217905550610a37565b604051602001610910906115c7565b6040516020818303038152906040528051906020012086604051602001610937919061137f565b60405160208183030381529060405280519060200120036109845760078160010160006101000a81548160ff0219169083600981111561097a57610979610fd5565b5b0217905550610a36565b60405160200161099390611628565b60405160208183030381529060405280519060200120866040516020016109ba919061137f565b6040516020818303038152906040528051906020012003610a075760088160010160006101000a81548160ff021916908360098111156109fd576109fc610fd5565b5b0217905550610a35565b60098160010160006101000a81548160ff02191690836009811115610a2f57610a2e610fd5565b5b02179055505b5b5b5b5b5b5b5b8686869350935093505093509350939050565b6000606080600060016000815480929190610a699061166c565b9190505590506000806000838152602001908152602001600020905086816000018190555060008160010160006101000a81548160ff02191690836009811115610ab657610ab5610fd5565b5b02179055508060030186908060018154018082558091505060019003906000526020600020016000909190919091509081610af19190611210565b5042816002018190555081866040518060400160405280600781526020017f43726561746564000000000000000000000000000000000000000000000000008152509094509450945050509250925092565b606080600080600087815260200190815260200160002090508060040185908060018154018082558091505060019003906000526020600020016000909190919091509081610b929190611210565b508060050184908060018154018082558091505060019003906000526020600020016000909190919091509081610bc99190611210565b5083600286604051610bdb919061137f565b90815260200160405180910390209081610bf59190611210565b5084849250925050935093915050565b6000604051905090565b600080fd5b600080fd5b6000819050919050565b610c2c81610c19565b8114610c3757600080fd5b50565b600081359050610c4981610c23565b92915050565b600060208284031215610c6557610c64610c0f565b5b6000610c7384828501610c3a565b91505092915050565b600081519050919050565b600082825260208201905092915050565b60005b83811015610cb6578082015181840152602081019050610c9b565b60008484015250505050565b6000601f19601f8301169050919050565b6000610cde82610c7c565b610ce88185610c87565b9350610cf8818560208601610c98565b610d0181610cc2565b840191505092915050565b60006020820190508181036000830152610d268184610cd3565b905092915050565b600080fd5b600080fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b610d7082610cc2565b810181811067ffffffffffffffff82111715610d8f57610d8e610d38565b5b80604052505050565b6000610da2610c05565b9050610dae8282610d67565b919050565b600067ffffffffffffffff821115610dce57610dcd610d38565b5b610dd782610cc2565b9050602081019050919050565b82818337600083830152505050565b6000610e06610e0184610db3565b610d98565b905082815260208101848484011115610e2257610e21610d33565b5b610e2d848285610de4565b509392505050565b600082601f830112610e4a57610e49610d2e565b5b8135610e5a848260208601610df3565b91505092915050565b600080600060608486031215610e7c57610e7b610c0f565b5b6000610e8a86828701610c3a565b935050602084013567ffffffffffffffff811115610eab57610eaa610c14565b5b610eb786828701610e35565b925050604084013567ffffffffffffffff811115610ed857610ed7610c14565b5b610ee486828701610e35565b9150509250925092565b610ef781610c19565b82525050565b6000606082019050610f126000830186610eee565b8181036020830152610f248185610cd3565b90508181036040830152610f388184610cd3565b9050949350505050565b60008060408385031215610f5957610f58610c0f565b5b6000610f6785828601610c3a565b925050602083013567ffffffffffffffff811115610f8857610f87610c14565b5b610f9485828601610e35565b9150509250929050565b60006040820190508181036000830152610fb88185610cd3565b90508181036020830152610fcc8184610cd3565b90509392505050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b6000600282049050600182168061104b57607f821691505b60208210810361105e5761105d611004565b5b50919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b6000600883026110c67fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82611089565b6110d08683611089565b95508019841693508086168417925050509392505050565b6000819050919050565b600061110d61110861110384610c19565b6110e8565b610c19565b9050919050565b6000819050919050565b611127836110f2565b61113b61113382611114565b848454611096565b825550505050565b600090565b611150611143565b61115b81848461111e565b505050565b5b8181101561117f57611174600082611148565b600181019050611161565b5050565b601f8211156111c45761119581611064565b61119e84611079565b810160208510156111ad578190505b6111c16111b985611079565b830182611160565b50505b505050565b600082821c905092915050565b60006111e7600019846008026111c9565b1980831691505092915050565b600061120083836111d6565b9150826002028217905092915050565b61121982610c7c565b67ffffffffffffffff81111561123257611231610d38565b5b61123c8254611033565b611247828285611183565b600060209050601f83116001811461127a5760008415611268578287015190505b61127285826111f4565b8655506112da565b601f19841661128886611064565b60005b828110156112b05784890151825560018201915060208501945060208101905061128b565b868310156112cd57848901516112c9601f8916826111d6565b8355505b6001600288020188555050505b505050505050565b600081905092915050565b7f437573746f6d4365727469666963617465640000000000000000000000000000600082015250565b60006113236012836112e2565b915061132e826112ed565b601282019050919050565b600061134482611316565b9150819050919050565b600061135982610c7c565b61136381856112e2565b9350611373818560208601610c98565b80840191505092915050565b600061138b828461134e565b915081905092915050565b7f546178436f6c6c65637465640000000000000000000000000000000000000000600082015250565b60006113cc600c836112e2565b91506113d782611396565b600c82019050919050565b60006113ed826113bf565b9150819050919050565b7f496d706f72746564000000000000000000000000000000000000000000000000600082015250565b600061142d6008836112e2565b9150611438826113f7565b600882019050919050565b600061144e82611420565b9150819050919050565b7f6f6e506f72740000000000000000000000000000000000000000000000000000600082015250565b600061148e6006836112e2565b915061149982611458565b600682019050919050565b60006114af82611481565b9150819050919050565b7f57617265686f7573656400000000000000000000000000000000000000000000600082015250565b60006114ef600a836112e2565b91506114fa826114b9565b600a82019050919050565b6000611510826114e2565b9150819050919050565b7f4c6f616465640000000000000000000000000000000000000000000000000000600082015250565b60006115506006836112e2565b915061155b8261151a565b600682019050919050565b600061157182611543565b9150819050919050565b7f5369676e65640000000000000000000000000000000000000000000000000000600082015250565b60006115b16006836112e2565b91506115bc8261157b565b600682019050919050565b60006115d2826115a4565b9150819050919050565b7f526566756e646564000000000000000000000000000000000000000000000000600082015250565b60006116126008836112e2565b915061161d826115dc565b600882019050919050565b600061163382611605565b9150819050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b600061167782610c19565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82036116a9576116a861163d565b5b60018201905091905056fea2646970667358221220e1626f3f1c3b2741086769df181d037bcaf30dae0de89a34c39903d6d8fd3e8964736f6c63430008120033";
    public static String contractName = "EviContract";
    private static XuperChainWrapper xuperChainWrapper = XuperChainWrapper.build();
    /*{contractAccount=XC1234567890123456@xuper, txHash=d9101837ba4804861740b145be32061de496036ac611d99386a7a9bea5d92261}*/


    public void deploy(){
        Map<String, String> deployResult = xuperChainWrapper.deploy(bin, abi, contractName, new HashMap<String, String>());
        System.out.println(deployResult);
    }

    /*
    新建存证
     * @param orderIndex 订单在链上的唯一索引，用于关联订单实体
     * @param evidenceDigest 首次创建，"进口订单"的证据

     * @return FunctionResult，其中result 包括evidenceIndex 证据索引
     */
    public FunctionResult newEvidenceTC(BigInteger orderIndex, String evidenceDigest) throws JsonProcessingException {
        List<String> args = new ArrayList<>();
        args.add(String.valueOf(orderIndex));
        args.add(evidenceDigest);
        FunctionResult functionResult = xuperChainWrapper.send(abi, contractName, null, "newEvidence", args, false, null, false);
        System.out.println("----" + functionResult.result);
        System.out.println("----" + functionResult.transactionHash);
        return functionResult;

    }

    /*
    依据业务所处不同阶段，可由中海龙、客户、银行调用该函数
    * @param onChainIndex 证据索引
    * @param newState 新加入的证据状态，前端传入参数CustomCertificated，TaxCollected等
    * @param evidenceDigest 新加入的证据摘要


    * @return FunctionResult，其中，result包括 evidenceIndex 更新后的证据索引
    新增证据，包括 报关核验、完税、进口、到港、入库、放款、合同签订、还款、出库
    */
    public FunctionResult updateOCEvidence(BigInteger onChainIndex, String newState,  String evidenceDigest) throws JsonProcessingException {
        List<String> args = new ArrayList<>();
        args.add(String.valueOf(onChainIndex));
        args.add(newState);
        args.add(evidenceDigest);
        FunctionResult functionResult = xuperChainWrapper.send(abi, contractName, null, "updateEvidence", args, false, null, false);
        System.out.println("----" + functionResult.result);
        System.out.println("----" + functionResult.transactionHash);
        return functionResult;
    }

    public FunctionResult  queryOCEvidenceState(BigInteger onChainIndex) throws JsonProcessingException {
        List<String> args = new ArrayList<>();
        args.add(String.valueOf(onChainIndex));
        FunctionResult functionResult = xuperChainWrapper.send(abi, contractName, null, "queryEvidenceState", args, false, null, false);
        System.out.println("----" + functionResult.result);
        System.out.println("----" + functionResult.transactionHash);
        return functionResult;
    }

    /*
   法院实体对关联evidenceIndex的当前证据添加签名
   @param onChainIndex 证据链上唯一索引
   @param pubKey 法院链上账户公钥
   @param signature 由法院用上述公钥对应的私钥签名生成

   @return FunctionResult，其中，result包括pubKey和signature
   */
    public FunctionResult addSignatureOC(BigInteger onChainIndex, String pubKey, String signature) throws JsonProcessingException {
        List<String> args = new ArrayList<>();
        args.add(String.valueOf(onChainIndex));
        args.add(pubKey);
        args.add(signature);
        FunctionResult functionResult = xuperChainWrapper.send(abi, contractName, null, "addSignatures", args, false, null, false);
        System.out.println("----" + functionResult.result);
        System.out.println("----" + functionResult.transactionHash);
        return functionResult;

    }





}
