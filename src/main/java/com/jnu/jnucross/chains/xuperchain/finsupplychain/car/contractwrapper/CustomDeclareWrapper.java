package com.jnu.jnucross.chains.xuperchain.finsupplychain.car.contractwrapper;

import com.fasterxml.jackson.core.JsonProcessingException;
import com.jnu.jnucross.chains.FunctionResult;
import com.jnu.jnucross.chains.xuperchain.XuperChainWrapper;
import com.jnu.jnucross.chains.xuperchain.finsupplychain.car.entity.CustomFormOC;

import java.math.BigInteger;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

/**
 * @author Jessy
 * @ClassName CustomDeclareWrapper
 * @Date 2023/8/28 17:47
 * @Version V1.0
 * @Description
 */
public class CustomDeclareWrapper {

    private static String abi = "[{\"inputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"formIndex\",\"type\":\"uint256\"}],\"name\":\"ValueIndex\",\"type\":\"event\"},{\"inputs\":[{\"internalType\":\"string\",\"name\":\"orderId\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"customNo\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"customCode\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"state\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"formDigest\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"createTime\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"certificateDigest\",\"type\":\"string\"}],\"name\":\"createCustomForm\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"formIndex\",\"type\":\"uint256\"}],\"name\":\"queryCustomForm\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"formIndex\",\"type\":\"uint256\"}],\"name\":\"queryCustomState\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"stateStr\",\"type\":\"string\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"formIndex\",\"type\":\"uint256\"},{\"internalType\":\"string\",\"name\":\"newOrderState\",\"type\":\"string\"}],\"name\":\"updateCustomFormState\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"nonpayable\",\"type\":\"function\"}]";
    private static String bin = "608060405234801561001057600080fd5b5061214b806100206000396000f3fe608060405234801561001057600080fd5b506004361061004c5760003560e01c8063142b0606146100515780634d31032f1461008757806375147a5e146100b75780638c614334146100e7575b600080fd5b61006b600480360381019061006691906112b9565b610117565b60405161007e9796959493929190611376565b60405180910390f35b6100a1600480360381019061009c91906112b9565b6104c1565b6040516100ae9190611416565b60405180910390f35b6100d160048036038101906100cc919061156d565b610af4565b6040516100de91906115e4565b60405180910390f35b61010160048036038101906100fc91906115ff565b610b8c565b60405161010e9190611774565b60405180910390f35b6060806060806060806060600061012d896104c1565b905060008060008b815260200190815260200160002090508060000181600101826002018484600401856005018660060186805461016a906117be565b80601f0160208091040260200160405190810160405280929190818152602001828054610196906117be565b80156101e35780601f106101b8576101008083540402835291602001916101e3565b820191906000526020600020905b8154815290600101906020018083116101c657829003601f168201915b505050505096508580546101f6906117be565b80601f0160208091040260200160405190810160405280929190818152602001828054610222906117be565b801561026f5780601f106102445761010080835404028352916020019161026f565b820191906000526020600020905b81548152906001019060200180831161025257829003601f168201915b50505050509550848054610282906117be565b80601f01602080910402602001604051908101604052809291908181526020018280546102ae906117be565b80156102fb5780601f106102d0576101008083540402835291602001916102fb565b820191906000526020600020905b8154815290600101906020018083116102de57829003601f168201915b5050505050945082805461030e906117be565b80601f016020809104026020016040519081016040528092919081815260200182805461033a906117be565b80156103875780601f1061035c57610100808354040283529160200191610387565b820191906000526020600020905b81548152906001019060200180831161036a57829003601f168201915b5050505050925081805461039a906117be565b80601f01602080910402602001604051908101604052809291908181526020018280546103c6906117be565b80156104135780601f106103e857610100808354040283529160200191610413565b820191906000526020600020905b8154815290600101906020018083116103f657829003601f168201915b50505050509150808054610426906117be565b80601f0160208091040260200160405190810160405280929190818152602001828054610452906117be565b801561049f5780601f106104745761010080835404028352916020019161049f565b820191906000526020600020905b81548152906001019060200180831161048257829003601f168201915b5050505050905098509850985098509850985098505050919395979092949650565b6060600080600084815260200190815260200160002060030160009054906101000a900460ff1690506000600e8111156104fe576104fd6117ef565b5b81600e811115610511576105106117ef565b5b03610553576040518060400160405280600481526020017f43465f4e000000000000000000000000000000000000000000000000000000008152509150610aee565b6001600e811115610567576105666117ef565b5b81600e81111561057a576105796117ef565b5b036105bc576040518060400160405280600481526020017f43465f55000000000000000000000000000000000000000000000000000000008152509150610aed565b6002600e8111156105d0576105cf6117ef565b5b81600e8111156105e3576105e26117ef565b5b03610625576040518060400160405280600481526020017f43465f53000000000000000000000000000000000000000000000000000000008152509150610aec565b6003600e811115610639576106386117ef565b5b81600e81111561064c5761064b6117ef565b5b0361068e576040518060400160405280600581526020017f43465f50520000000000000000000000000000000000000000000000000000008152509150610aeb565b6004600e8111156106a2576106a16117ef565b5b81600e8111156106b5576106b46117ef565b5b036106f7576040518060400160405280600481526020017f43465f52000000000000000000000000000000000000000000000000000000008152509150610aea565b6005600e81111561070b5761070a6117ef565b5b81600e81111561071e5761071d6117ef565b5b03610760576040518060400160405280600581526020017f43465f53570000000000000000000000000000000000000000000000000000008152509150610ae9565b6006600e811115610774576107736117ef565b5b81600e811115610787576107866117ef565b5b036107c9576040518060400160405280600581526020017f43465f53530000000000000000000000000000000000000000000000000000008152509150610ae8565b6007600e8111156107dd576107dc6117ef565b5b81600e8111156107f0576107ef6117ef565b5b03610832576040518060400160405280600181526020017f37000000000000000000000000000000000000000000000000000000000000008152509150610ae7565b6008600e811115610846576108456117ef565b5b81600e811115610859576108586117ef565b5b0361089b576040518060400160405280600181526020017f4c000000000000000000000000000000000000000000000000000000000000008152509150610ae6565b6009600e8111156108af576108ae6117ef565b5b81600e8111156108c2576108c16117ef565b5b03610904576040518060400160405280600181526020017f4a000000000000000000000000000000000000000000000000000000000000008152509150610ae5565b600a600e811115610918576109176117ef565b5b81600e81111561092b5761092a6117ef565b5b0361096d576040518060400160405280600181526020017f4b000000000000000000000000000000000000000000000000000000000000008152509150610ae4565b600b600e811115610981576109806117ef565b5b81600e811115610994576109936117ef565b5b036109d6576040518060400160405280600181526020017f43000000000000000000000000000000000000000000000000000000000000008152509150610ae3565b600c600e8111156109ea576109e96117ef565b5b81600e8111156109fd576109fc6117ef565b5b03610a3f576040518060400160405280600181526020017f33000000000000000000000000000000000000000000000000000000000000008152509150610ae2565b600d600e811115610a5357610a526117ef565b5b81600e811115610a6657610a656117ef565b5b03610aa8576040518060400160405280600181526020017f52000000000000000000000000000000000000000000000000000000000000008152509150610ae1565b6040518060400160405280600181526020017f500000000000000000000000000000000000000000000000000000000000000081525091505b5b5b5b5b5b5b5b5b5b5b5b5b5b50919050565b60008060008085815260200190815260200160002090506000600190506000610b1c85610d0a565b90506000600e811115610b3257610b316117ef565b5b81600e811115610b4557610b446117ef565b5b03610b535760009150610b80565b808360030160006101000a81548160ff0219169083600e811115610b7a57610b796117ef565b5b02179055505b81935050505092915050565b60008060016000815480929190610ba29061184d565b9190505590506000610bb387610d0a565b90506040518060e001604052808b81526020018a815260200189815260200182600e811115610be557610be46117ef565b5b8152602001878152602001868152602001858152506000808481526020019081526020016000206000820151816000019081610c219190611a41565b506020820151816001019081610c379190611a41565b506040820151816002019081610c4d9190611a41565b5060608201518160030160006101000a81548160ff0219169083600e811115610c7957610c786117ef565b5b02179055506080820151816004019081610c939190611a41565b5060a0820151816005019081610ca99190611a41565b5060c0820151816006019081610cbf9190611a41565b509050507f47cb7dcbe6ba9c9cbb06ea3249d6a574781821929f410df91b4d02fd7cd9cc0f82604051610cf29190611774565b60405180910390a18192505050979650505050505050565b600080604051602001610d1c90611b6a565b6040516020818303038152906040528051906020012083604051602001610d439190611bb0565b6040516020818303038152906040528051906020012003610d675760009050611266565b604051602001610d7690611c13565b6040516020818303038152906040528051906020012083604051602001610d9d9190611bb0565b6040516020818303038152906040528051906020012003610dc15760019050611265565b604051602001610dd090611c74565b6040516020818303038152906040528051906020012083604051602001610df79190611bb0565b6040516020818303038152906040528051906020012003610e1b5760029050611264565b604051602001610e2a90611cd5565b6040516020818303038152906040528051906020012083604051602001610e519190611bb0565b6040516020818303038152906040528051906020012003610e755760039050611263565b604051602001610e8490611d36565b6040516020818303038152906040528051906020012083604051602001610eab9190611bb0565b6040516020818303038152906040528051906020012003610ecf5760049050611262565b604051602001610ede90611d97565b6040516020818303038152906040528051906020012083604051602001610f059190611bb0565b6040516020818303038152906040528051906020012003610f295760059050611261565b604051602001610f3890611df8565b6040516020818303038152906040528051906020012083604051602001610f5f9190611bb0565b6040516020818303038152906040528051906020012003610f835760069050611260565b604051602001610f9290611e59565b6040516020818303038152906040528051906020012083604051602001610fb99190611bb0565b6040516020818303038152906040528051906020012003610fdd576007905061125f565b604051602001610fec90611eba565b60405160208183030381529060405280519060200120836040516020016110139190611bb0565b6040516020818303038152906040528051906020012003611037576008905061125e565b60405160200161104690611f1b565b604051602081830303815290604052805190602001208360405160200161106d9190611bb0565b6040516020818303038152906040528051906020012003611091576009905061125d565b6040516020016110a090611f7c565b60405160208183030381529060405280519060200120836040516020016110c79190611bb0565b60405160208183030381529060405280519060200120036110eb57600a905061125c565b6040516020016110fa90611fdd565b60405160208183030381529060405280519060200120836040516020016111219190611bb0565b604051602081830303815290604052805190602001200361114557600b905061125b565b6040516020016111549061203e565b604051602081830303815290604052805190602001208360405160200161117b9190611bb0565b604051602081830303815290604052805190602001200361119f57600c905061125a565b6040516020016111ae9061209f565b60405160208183030381529060405280519060200120836040516020016111d59190611bb0565b60405160208183030381529060405280519060200120036111f957600d9050611259565b60405160200161120890612100565b604051602081830303815290604052805190602001208360405160200161122f9190611bb0565b604051602081830303815290604052805190602001200361125357600e9050611258565b600090505b5b5b5b5b5b5b5b5b5b5b5b5b5b5b80915050919050565b6000604051905090565b600080fd5b600080fd5b6000819050919050565b61129681611283565b81146112a157600080fd5b50565b6000813590506112b38161128d565b92915050565b6000602082840312156112cf576112ce611279565b5b60006112dd848285016112a4565b91505092915050565b600081519050919050565b600082825260208201905092915050565b60005b83811015611320578082015181840152602081019050611305565b60008484015250505050565b6000601f19601f8301169050919050565b6000611348826112e6565b61135281856112f1565b9350611362818560208601611302565b61136b8161132c565b840191505092915050565b600060e0820190508181036000830152611390818a61133d565b905081810360208301526113a4818961133d565b905081810360408301526113b8818861133d565b905081810360608301526113cc818761133d565b905081810360808301526113e0818661133d565b905081810360a08301526113f4818561133d565b905081810360c0830152611408818461133d565b905098975050505050505050565b60006020820190508181036000830152611430818461133d565b905092915050565b600080fd5b600080fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b61147a8261132c565b810181811067ffffffffffffffff8211171561149957611498611442565b5b80604052505050565b60006114ac61126f565b90506114b88282611471565b919050565b600067ffffffffffffffff8211156114d8576114d7611442565b5b6114e18261132c565b9050602081019050919050565b82818337600083830152505050565b600061151061150b846114bd565b6114a2565b90508281526020810184848401111561152c5761152b61143d565b5b6115378482856114ee565b509392505050565b600082601f83011261155457611553611438565b5b81356115648482602086016114fd565b91505092915050565b6000806040838503121561158457611583611279565b5b6000611592858286016112a4565b925050602083013567ffffffffffffffff8111156115b3576115b261127e565b5b6115bf8582860161153f565b9150509250929050565b60008115159050919050565b6115de816115c9565b82525050565b60006020820190506115f960008301846115d5565b92915050565b600080600080600080600060e0888a03121561161e5761161d611279565b5b600088013567ffffffffffffffff81111561163c5761163b61127e565b5b6116488a828b0161153f565b975050602088013567ffffffffffffffff8111156116695761166861127e565b5b6116758a828b0161153f565b965050604088013567ffffffffffffffff8111156116965761169561127e565b5b6116a28a828b0161153f565b955050606088013567ffffffffffffffff8111156116c3576116c261127e565b5b6116cf8a828b0161153f565b945050608088013567ffffffffffffffff8111156116f0576116ef61127e565b5b6116fc8a828b0161153f565b93505060a088013567ffffffffffffffff81111561171d5761171c61127e565b5b6117298a828b0161153f565b92505060c088013567ffffffffffffffff81111561174a5761174961127e565b5b6117568a828b0161153f565b91505092959891949750929550565b61176e81611283565b82525050565b60006020820190506117896000830184611765565b92915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b600060028204905060018216806117d657607f821691505b6020821081036117e9576117e861178f565b5b50919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b600061185882611283565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff820361188a5761188961181e565b5b600182019050919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b6000600883026118f77fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff826118ba565b61190186836118ba565b95508019841693508086168417925050509392505050565b6000819050919050565b600061193e61193961193484611283565b611919565b611283565b9050919050565b6000819050919050565b61195883611923565b61196c61196482611945565b8484546118c7565b825550505050565b600090565b611981611974565b61198c81848461194f565b505050565b5b818110156119b0576119a5600082611979565b600181019050611992565b5050565b601f8211156119f5576119c681611895565b6119cf846118aa565b810160208510156119de578190505b6119f26119ea856118aa565b830182611991565b50505b505050565b600082821c905092915050565b6000611a18600019846008026119fa565b1980831691505092915050565b6000611a318383611a07565b9150826002028217905092915050565b611a4a826112e6565b67ffffffffffffffff811115611a6357611a62611442565b5b611a6d82546117be565b611a788282856119b4565b600060209050601f831160018114611aab5760008415611a99578287015190505b611aa38582611a25565b865550611b0b565b601f198416611ab986611895565b60005b82811015611ae157848901518255600182019150602085019450602081019050611abc565b86831015611afe5784890151611afa601f891682611a07565b8355505b6001600288020188555050505b505050505050565b600081905092915050565b7f43465f4e00000000000000000000000000000000000000000000000000000000600082015250565b6000611b54600483611b13565b9150611b5f82611b1e565b600482019050919050565b6000611b7582611b47565b9150819050919050565b6000611b8a826112e6565b611b948185611b13565b9350611ba4818560208601611302565b80840191505092915050565b6000611bbc8284611b7f565b915081905092915050565b7f43465f5500000000000000000000000000000000000000000000000000000000600082015250565b6000611bfd600483611b13565b9150611c0882611bc7565b600482019050919050565b6000611c1e82611bf0565b9150819050919050565b7f43465f5300000000000000000000000000000000000000000000000000000000600082015250565b6000611c5e600483611b13565b9150611c6982611c28565b600482019050919050565b6000611c7f82611c51565b9150819050919050565b7f43465f5052000000000000000000000000000000000000000000000000000000600082015250565b6000611cbf600583611b13565b9150611cca82611c89565b600582019050919050565b6000611ce082611cb2565b9150819050919050565b7f43465f5200000000000000000000000000000000000000000000000000000000600082015250565b6000611d20600483611b13565b9150611d2b82611cea565b600482019050919050565b6000611d4182611d13565b9150819050919050565b7f43465f5357000000000000000000000000000000000000000000000000000000600082015250565b6000611d81600583611b13565b9150611d8c82611d4b565b600582019050919050565b6000611da282611d74565b9150819050919050565b7f43465f5353000000000000000000000000000000000000000000000000000000600082015250565b6000611de2600583611b13565b9150611ded82611dac565b600582019050919050565b6000611e0382611dd5565b9150819050919050565b7f3700000000000000000000000000000000000000000000000000000000000000600082015250565b6000611e43600183611b13565b9150611e4e82611e0d565b600182019050919050565b6000611e6482611e36565b9150819050919050565b7f4c00000000000000000000000000000000000000000000000000000000000000600082015250565b6000611ea4600183611b13565b9150611eaf82611e6e565b600182019050919050565b6000611ec582611e97565b9150819050919050565b7f4a00000000000000000000000000000000000000000000000000000000000000600082015250565b6000611f05600183611b13565b9150611f1082611ecf565b600182019050919050565b6000611f2682611ef8565b9150819050919050565b7f4b00000000000000000000000000000000000000000000000000000000000000600082015250565b6000611f66600183611b13565b9150611f7182611f30565b600182019050919050565b6000611f8782611f59565b9150819050919050565b7f4300000000000000000000000000000000000000000000000000000000000000600082015250565b6000611fc7600183611b13565b9150611fd282611f91565b600182019050919050565b6000611fe882611fba565b9150819050919050565b7f3300000000000000000000000000000000000000000000000000000000000000600082015250565b6000612028600183611b13565b915061203382611ff2565b600182019050919050565b60006120498261201b565b9150819050919050565b7f5200000000000000000000000000000000000000000000000000000000000000600082015250565b6000612089600183611b13565b915061209482612053565b600182019050919050565b60006120aa8261207c565b9150819050919050565b7f5000000000000000000000000000000000000000000000000000000000000000600082015250565b60006120ea600183611b13565b91506120f5826120b4565b600182019050919050565b600061210b826120dd565b915081905091905056fea2646970667358221220e8784dffc55067291bef6eae7462b374af714efad53127abc78f703675f096c664736f6c63430008120033";
    private static String contractName = "CustomDeclare4";
    private static XuperChainWrapper xuperChainWrapper = XuperChainWrapper.build();

    public static void deploy(){
        Map<String, String> deployResult = xuperChainWrapper.deploy(bin, abi, contractName, new HashMap<String, String>());
        System.out.println(deployResult);
    }

    public static BigInteger uploadCustomFormTC(CustomFormOC customForm) throws JsonProcessingException {
        List<String> args = new ArrayList<>();
        args.add(customForm.getOrderId());
        args.add(customForm.getCustomNo());
        args.add(customForm.getCustomCode());
        args.add(customForm.getFormDigest());
        args.add(customForm.getCreateTime());
        args.add(customForm.getCertificateDigest());
        FunctionResult functionResult = xuperChainWrapper.send(abi, contractName, null, "createCustomForm", args, false, null, false);
        String returnIndex = functionResult.result.get(0).toString();
        customForm.setFormIndexOnChain(new BigInteger(returnIndex));
        System.out.println("----" + functionResult.result.get(0));
        System.out.println("----" + functionResult.transactionHash);
        return new BigInteger(returnIndex);
    }

    public static boolean updateOCCustomFormState(BigInteger onChainIndex, String newState) throws JsonProcessingException {
        List<String> args = new ArrayList<>();
        args.add(String.valueOf(onChainIndex));
        args.add(newState);
        FunctionResult functionResult = xuperChainWrapper.send(abi, contractName, null, "updateCustomFormState", args, false, null, false);
        System.out.println("----" + functionResult.result);
        System.out.println("----" + functionResult.transactionHash);
        return true;
    }

    public static List queryOCCustomForm(BigInteger onChainIndex) throws JsonProcessingException {
        List<String> args = new ArrayList<>();
        args.add(String.valueOf(onChainIndex));
        FunctionResult functionResult = xuperChainWrapper.send(abi, contractName, null, "queryCustomForm", args, false, null, false);
        System.out.println("----" + functionResult.result);
        System.out.println("----" + functionResult.transactionHash);
        return functionResult.result;
    }

    public static List  queryOCCustomFormState(BigInteger onChainIndex) throws JsonProcessingException {
        List<String> args = new ArrayList<>();
        args.add(String.valueOf(onChainIndex));
        FunctionResult functionResult = xuperChainWrapper.send(abi, contractName, null, "queryCustomState", args, false, null, false);
        System.out.println("----" + functionResult.result);
        System.out.println("----" + functionResult.transactionHash);
        return functionResult.result;
    }
}
